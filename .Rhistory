if (!require("pacman")) install.packages("pacman")
pacman::p_load(ggplot2, sf, readr, dplyr)
##  load shapes
regions <- read_sf("~/Downloads/Region 2/UDHS Regions 2019.shp")
district_sp <- read_rds("/Users/rutayisiremeddy/Documents/R Resources/Functions/Plotter_quarter/District_shape.rds")
water_sp <- read_rds("/Users/rutayisiremeddy/Documents/R Resources/Functions/Plotter_quarter/water_shape.rds")
readr::write_rds(
regions_sp, "regions_sp.rds"
)
##  load shapes
regions_sp <- read_sf("~/Downloads/Region 2/UDHS Regions 2019.shp")
district_sp <- read_rds("/Users/rutayisiremeddy/Documents/R Resources/Functions/Plotter_quarter/District_shape.rds")
water_sp <- read_rds("/Users/rutayisiremeddy/Documents/R Resources/Functions/Plotter_quarter/water_shape.rds")
readr::write_rds(
regions_sp, "regions_sp.rds"
)
readr::write_rds(
district_sp, "regions_sp.rds"
)
readr::write_rds(
water_sp, "regions_sp.rds"
)
# regions
regions_sp <- readr::read_rds(
('data/regions_sp')
# districts
district_sp <- readr::read_rds(
##  load shapes
regions_sp <- read_sf("~/Downloads/Region 2/UDHS Regions 2019.shp")
district_sp <- read_rds("/Users/rutayisiremeddy/Documents/R Resources/Functions/Plotter_quarter/District_shape.rds")
water_sp <- read_rds("/Users/rutayisiremeddy/Documents/R Resources/Functions/Plotter_quarter/water_shape.rds")
readr::read_rds(
readr::write_rds(
district_sp, "regions_sp.rds"
)
readr::write_rds(
##  load shapes
regions_sp <- read_sf("~/Downloads/Region 2/UDHS Regions 2019.shp")
district_sp <- read_rds("/Users/rutayisiremeddy/Documents/R Resources/Functions/Plotter_quarter/District_shape.rds")
water_sp <- read_rds("/Users/rutayisiremeddy/Documents/R Resources/Functions/Plotter_quarter/water_shape.rds")
readr::read_rds(
readr::write_rds(
district_sp, "regions_sp.rds"
)
readr::write_rds(
('data/regions_sp')
readr::write_rds(
district_sp, "data/regions_sp.rds"
)
readr::write_rds(
water_sp, "data/water_sp.rds"
)
readr::read_rds(
readr::write_rds(
district_sp, "data/regions_sp.rds"
)
readr::write_rds(
##  load shapes
regions_sp <- read_sf("~/Downloads/Region 2/UDHS Regions 2019.shp")
district_sp <- read_rds("/Users/rutayisiremeddy/Documents/R Resources/Functions/Plotter_quarter/District_shape.rds")
water_sp <- read_rds("/Users/rutayisiremeddy/Documents/R Resources/Functions/Plotter_quarter/water_shape.rds")
readr::read_rds(
readr::write_rds(
district_sp, "data/district_sp.rds"
)
readr::write_rds(
(regions_sp , 'data/regions_sp')
readr::read_rds(regions_sp ,
'data/regions_sp')
readr::read_rds(regions_sp ,
'data/regions_sp.rds')
readr::write_rds(regions_sp ,
'data/regions_sp.rds')
readr::write_rds(district_sp, 'data/district_sp.rds')
readr::write_rds(
water_sp, 'data/water_sp.rds')
readr::write_rds(regions_sp ,
here('blog/Maps in R/glodata/regions_sp.rds'))
##  load shapes
regions_sp <- read_sf("~/Downloads/Region 2/UDHS Regions 2019.shp")
district_sp <- read_rds("/Users/rutayisiremeddy/Documents/R Resources/Functions/Plotter_quarter/District_shape.rds")
water_sp <- read_rds("/Users/rutayisiremeddy/Documents/R Resources/Functions/Plotter_quarter/water_shape.rds")
readr::write_rds(regions_sp ,
here('blog/Maps in R/glodata/regions_sp.rds'))
pacman::p_load(ggplot2, sf, readr, dplyr , here)
readr::write_rds(regions_sp ,
here('blog/Maps in R/glodata/regions_sp.rds'))
readr::write_rds(regions_sp ,
here('blog/Maps in R/data/regions_sp.rds'))
readr::write_rds(district_sp, here('blog/Maps in R/data/district_sp.rds')
readr::write_rds(
readr::write_rds( water_sp, here('blog/Maps in R/data/water_sp.rds')
readr::write_rds( water_sp, here('blog/Maps in R/data/water_sp.rds'))
readr::write_rds( water_sp, here('blog/Maps in R/data/water_sp.rds'))
##  load shapes
readr::read_rds(regions_sp ,
here('blog/Maps in R/data/regions_sp.rds'))
##  load shapes
readr::read_rds(regions_sp ,
here('blog/Maps in R/data/regions_sp.rds'))
here::here()
##  load shapes
readr::read_rds(
here('blog/Maps in R/data/regions_sp.rds'))
readr::read_rds(here('blog/Maps in R/data/district_sp.rds')
readr::read_rds( here('blog/Maps in R/data/water_sp.rds'))
readr::read_rds(
here('blog/Maps in R/data/regions_sp.rds'))
readr::read_rds(here('blog/Maps in R/data/district_sp.rds'))
readr::read_rds( here('blog/Maps in R/data/water_sp.rds'))
##  load shapes
regions_sp <- readr::read_rds(
here('blog/Maps in R/data/regions_sp.rds'))
district_sp <- readr::read_rds(here('blog/Maps in R/data/district_sp.rds'))
water_sp <- readr::read_rds( here('blog/Maps in R/data/water_sp.rds'))
names(regions_sp)
url("https://github.com/rutayisire24/website/blob/main/blog/Maps%20in%20R/data/district_sp.rds)")
##  load shapes
regions_sp <- readr::read_rds(
url("https://github.com/rutayisire24/website/blob/main/blog/Maps%20in%20R/data/regions_sp.rds)")
district_sp <- readr::read_rds(url("https://github.com/rutayisire24/website/blob/main/blog/Maps%20in%20R/data/district_sp.rds)"))
district_sp <-readr::read_rds(url("https://github.com/rutayisire24/website/blob/main/blog/Maps%20in%20R/data/district_sp.rds)"))
url("https://github.com/rutayisire24/website/blob/main/blog/Maps%20in%20R/data/regions_sp.rds)")
district_sp <-readr::read_rds(url("https://github.com/rutayisire24/website/blob/main/blog/Maps%20in%20R/data/district_sp.rds"))
district_sp <-readr::read_rds(url("https://github.com/rutayisire24/website/blob/main/blog/Maps%20in%20R/data/district_sp.rds)")
water_sp <- readr::read_rds(url("https://github.com/rutayisire24/website/blob/main/blog/Maps%20in%20R/data/water_sp.rds)"))
district_sp <-readr::read_rds(url("https://github.com/rutayisire24/website/blob/main/blog/Maps%20in%20R/data/district_sp.rds)")
district_sp <-readr::read_rds(url("https://github.com/rutayisire24/website/blob/main/blog/Maps%20in%20R/data/district_sp.rds)"))
district_sp <-readr::read_rds(url("https://github.com/rutayisire24/website/blob/main/blog/Maps%20in%20R/data/district_sp.rds)"))
##  urls
regions <- "https://github.com/rutayisire24/website/blob/main/blog/Maps%20in%20R/data/regions_sp.rds)"
district <- "https://github.com/rutayisire24/website/blob/main/blog/Maps%20in%20R/data/district_sp.rds)"
water <- "https://github.com/rutayisire24/website/blob/main/blog/Maps%20in%20R/data/water_sp.rds)"
regions_sp <- readr::read_rds(
url(regions)
district_sp <-readr::read_rds(url(district))
##  urls
regions <- "https://github.com/rutayisire24/website/blob/main/blog/Maps%20in%20R/data/regions_sp.rds)"
district <- "https://github.com/rutayisire24/website/blob/main/blog/Maps%20in%20R/data/district_sp.rds)"
water <- "https://github.com/rutayisire24/website/blob/main/blog/Maps%20in%20R/data/water_sp.rds)"
regions_sp <- readr::read_rds(
url(regions))
regions <- "https://github.com/rutayisire24/website/blog/main/blog/Maps%20in%20R/data/regions_sp.rds)"
district <- "https://github.com/rutayisire24/website/blog/main/blog/Maps%20in%20R/data/district_sp.rds)"
water <- "https://github.com/rutayisire24/website/blog/main/blog/Maps%20in%20R/data/water_sp.rds)"
##  urls
regions <- "https://github.com/rutayisire24/website/blog/main/blog/Maps%20in%20R/data/regions_sp.rds)"
district <- "https://github.com/rutayisire24/website/blog/main/blog/Maps%20in%20R/data/district_sp.rds)"
water <- "https://github.com/rutayisire24/website/blog/main/blog/Maps%20in%20R/data/water_sp.rds)"
regions_sp <- readr::read_rds(
url(regions))
# URLs
regions <- "https://raw.githubusercontent.com/rutayisire24/Open-Data-Uganda/blob/main/Shape%20Files/RDS/regions_sp.rds"
district <- "https://raw.githubusercontent.com/rutayisire24/Open-Data-Uganda/blob/main/Shape%20Files/RDS/district_sp.rds"
water <- "rutayisire24/Open-Data-Uganda/blob/main/Shape%20Files/RDS/water_sp.rds"
# Read files
regions_sp <- readRDS(url(regions))
district_sp <- readRDS(url(district))
# Read files
regions_sp <- readRDS(url(regions))
water_sp <- readRDS(url(water))
# URLs
regions <- "https://raw.githubusercontent.com/rutayisire24/website/main/blog/Maps%20in%20R/data/regions_sp.rds"
district <- "https://raw.githubusercontent.com/rutayisire24/website/main/blog/Maps%20in%20R/data/district_sp.rds"
water <- "https://raw.githubusercontent.com/rutayisire24/website/main/blog/Maps%20in%20R/data/water_sp.rds"
# Read files
regions_sp <- readRDS(url(regions))
district_sp <- readRDS(url(district))
water_sp <- readRDS(url(water))
names(district_sp)
unique(regions_sp$F15Regions)
unique(district_sp$District)
library(readxl)
population <- read_excel("~/Documents/Open Data Uganda/Census/populaiton.xlsx")
names(population)
population <- population |>
select(c(1,2,3))
names(population) <- c(
'district','villages','poln'
)
head(population)
head(district_sp)
population <- read_excel("~/Documents/Open Data Uganda/Census/populaiton.xlsx")
population <- population |>
select(c(1,2,3))
names(population) <- c(
'district','villages','poln'
)
readr::write_rds(
population , "blog/Maps 2/data/poln_2024.csv"
)
readr::write_rds(
population , here("blog/Maps 2/data/poln_2024.csv"
))
here()
poln_url <- "https://raw.githubusercontent.com/rutayisire24/website/blob/main/blog/Maps%202/data/poln_2024.csv"
poln <- read_csv(url(poln_url))
poln_url <- "https://raw.githubusercontent.com/rutayisire24/website/blog/Maps 2/data/poln_2024.csv"
poln <- read_csv(url(poln_url))
poln_url <- "https://raw.githubusercontent.com/rutayisire24/website/blob/main/blog/Maps%202/data/poln_2024.csv"
poln <- read_csv(url(poln_url))
poln <- read_csv(poln_url)
poln_url <- "https://raw.githubusercontent.com/rutayisire24/website/main/blog/Maps%202/data/poln_2024.csv"
poln <- read_csv(poln_url)
View(poln)
population <- read_excel("~/Documents/Open Data Uganda/Census/populaiton.xlsx")
population <- population |>
select(c(1,2,3))
names(population) <- c(
'district','villages','poln'
)
readr::write_rds(
population , here("blog/Maps 2/data/poln_2024.rds"
))
poln_2024 <- readRDS("~/Documents/website/blog/Maps 2/data/poln_2024.rds")
View(poln)
population <- read_excel("~/Documents/Open Data Uganda/Census/populaiton.xlsx")
population <- population |>
select(c(1,2,3))
names(population) <- c(
'district','villages','poln'
)
readr::write_rds(
population , here("blog/Maps 2/data/poln_2024.rds"))
library(readxl)
library(here)
population <- read_excel("~/Documents/Open Data Uganda/Census/populaiton.xlsx")
population <- population |>
select(1:3) |>  # Take first 3 columns
rename(
district = 1,
villages = 2,
poln = 3
)
write_rds(population, here("blog", "Maps 2", "data", "poln_2024.rds"))
poln_2024 <- readRDS("~/Documents/website/blog/Maps 2/data/poln_2024.rds")
poln_url <- "https://raw.githubusercontent.com/rutayisire24/website/main/blog/Maps%202/data/poln_2024.rds"
poln <- read_rds(poln_url)
# URLs
regions <- "https://raw.githubusercontent.com/rutayisire24/website/main/blog/Maps%20in%20R/data/regions_sp.rds"
district <- "https://raw.githubusercontent.com/rutayisire24/website/main/blog/Maps%20in%20R/data/district_sp.rds"
water <- "https://raw.githubusercontent.com/rutayisire24/website/main/blog/Maps%20in%20R/data/water_sp.rds"
# Read files
regions_sp <- readRDS(url(regions))
# Read files
regions_sp <- read_rds(here(
"blob/Maps/data/regions_sp.rds"))
# Read files
regions_sp <- read_rds(here(
"blog/Maps/data/regions_sp.rds"))
"blog/Maps/data/water_sp.rds")
names(poln)
names(district_sp)
?left_join
plot_data <- district_sp |>
left_join(poln , by = join_by(
district = District
))
plot_data <- district_sp |>
left_join(poln , by = join_by(
District == district
))
View(plot_data)
ggplot()+
geom_sf(data = plot_data, aes(fill = poln ))+
theme_map()
summary(poln$poln)
pacman::p_load(DBI)
con <- dbConnect(duckdb::duckdb(), "~/Documents/R_works/Geo_package/uganda_admin.duckdb", read_only = TRUE)
dbGetQuery(con , "SHOW TABLES;")
library(sf)
library(sf)
library(ggplot2)
query <- "SELECT location_id, district_name, ST_AsText(geom) AS wkt_geom FROM district WHERE geom IS NOT NULL;"
districts_raw_data <- dbGetQuery(con, query)
query <- "SELECT location_id, district_name, geom AS wkt_geom FROM district WHERE geom IS NOT NULL;"
districts_raw_data <- dbGetQuery(con, query)
View(districts_raw_data)
query <- "SELECT location_id, district_name, geom AS wkt_geom FROM district;"
query <- "SELECT location_id, district_name, geom AS wkt_geom FROM district;"
districts_raw_data <- dbGetQuery(con, query)
library(sf)
library(sf)
library(ggplot2)
query <- "SELECT location_id, district_name, geom AS wkt_geom FROM district;"
districts_raw_data <- dbGetQuery(con, query)
# 4. Close the database connection (good practice)
dbDisconnect(con, shutdown = TRUE)
print(paste("Successfully loaded", nrow(districts_sf), "districts as sf objects."))
tryCatch({
districts_sf <- st_as_sf(districts_raw_data, wkt = "geom", crs = 4326) # Common CRS for geographic data
# Check if the conversion was successful and if we have valid geometries
if (nrow(districts_sf) == 0) {
stop("No district data with geometries was loaded or all geometries were invalid.")
}
print(paste("Successfully loaded", nrow(districts_sf), "districts as sf objects."))
districts_sf <- st_as_sf(districts_raw_data, wkt = "geom", crs = 4326)
j
k
districts_sf <- st_as_sf(districts_raw_data, wkt = "geom", crs = 4326)
query <- "SELECT location_id, district_name, geom AS wkt_geom FROM district;"
districts_raw_data <- dbGetQuery(con, query)
pacman::p_load(DBI)
con <- dbConnect(duckdb::duckdb(), "~/Documents/R_works/Geo_package/uganda_admin.duckdb", read_only = TRUE)
library(sf)
library(ggplot2)
query <- "SELECT location_id, district_name, geom AS wkt_geom FROM district;"
districts_raw_data <- dbGetQuery(con, query)
View(districts_raw_data)
"
districts_raw_data <- dbGetQuery(con, query)
"
query <- ("SELECT
query <- ("SELECT
location_id,
district_name,
ST_AsText(geom) AS wkt_geom   -- convert geometry → WKT string
FROM district;")
districts_raw_data <- dbGetQuery(con, query)
library(sf)
library(ggplot2)
DBI::dbExecute(con, "INSTALL spatial; LOAD spatial;")
query <- ("SELECT
location_id,
district_name,
ST_AsText(geom) AS wkt_geom   -- convert geometry → WKT string
FROM district;")
districts_raw_data <- dbGetQuery(con, query)
View(district_sp)
View(districts_raw_data)
# 4. Close the database connection (good practice)
dbDisconnect(con, shutdown = TRUE) # For file-based DBs, shutdown=TRUE releases the file lock.
tryCatch({
districts_sf <- st_as_sf(districts_raw_data, wkt = "wkt_geom", crs = 4326) # Common CRS for geographic data
# Check if the conversion was successful and if we have valid geometries
if (nrow(districts_sf) == 0) {
stop("No district data with geometries was loaded or all geometries were invalid.")
}
print(paste("Successfully loaded", nrow(districts_sf), "districts as sf objects."))
# print(head(districts_sf)) # To inspect the first few rows
# 6. Create the plot using ggplot2
district_map_plot <- ggplot(data = districts_sf) +
geom_sf(aes(fill = district_name), color = "grey40", linewidth = 0.2) + # Fill by district name, add thin borders
# geom_sf_text(aes(label = district_name), size = 2.5, check_overlap = TRUE, color = "black") + # Optional: Add district labels (can be crowded)
labs(
title = "District Boundaries of Uganda",
subtitle = paste("Showing", nrow(districts_sf), "districts"),
fill = "District Name",
caption = paste("Data Source: DuckDB | Plotted:", Sys.Date())
) +
theme_minimal(base_size = 12) +
theme(
legend.position = "none", # Hide legend if too many districts, otherwise try "right" or "bottom"
plot.title = element_text(hjust = 0.5, face = "bold"),
plot.subtitle = element_text(hjust = 0.5)
)
# Display the plot
print(district_map_plot)
}, error = function(e) {
message("An error occurred:")
message(e)
message("\nTips for troubleshooting:")
message("- Ensure the path to your DuckDB file ('", db_path, "') is correct.")
message("- Verify that the 'district' table exists and contains a 'geom' column with valid WKT-convertible geometries.")
message("- Check that the DuckDB spatial extension is accessible and ST_AsText() works.")
message("- If using a different CRS than 4326, update the 'crs' parameter in st_as_sf().")
message("- Ensure column names in the query ('location_id', 'district_name', 'geom') match your 'district' table exactly.")
})
p <- ggplot(data = districts_sf) +
geom_sf(fill ="#cdb4db" ,color = "white", linewidth = 0.2) +
labs(
title = "District Boundaries of Uganda"
caption = paste("Data Source: DuckDB | Plotted:", Sys.Date())
p <- ggplot(data = districts_sf) +
geom_sf(fill ="#cdb4db" ,color = "white", linewidth = 0.2) +
labs(
title = "District Boundaries of Uganda",
caption = paste("Data Source: DuckDB | Plotted:", Sys.Date())
) +
ggthemes::theme_map(base_size = 12) +
theme(
legend.position = "none",
plot.title = element_text(hjust = 0.5, face = "bold"),
plot.subtitle = element_text(hjust = 0.5)
)
ggsave(
p,"map.png"
)
ggsave(p,"map.png")
p <- ggplot(data = districts_sf) +
geom_sf(fill ="#cdb4db" ,color = "white", linewidth = 0.2) +
labs(
title = "District Boundaries of Uganda",
caption = paste("Data Source: DuckDB | Plotted:", Sys.Date())
) +
ggthemes::theme_map(base_size = 12) +
theme(
legend.position = "none",
plot.title = element_text(hjust = 0.5, face = "bold"),
plot.subtitle = element_text(hjust = 0.5)
)
p
ggplot(data = districts_sf) +
geom_sf(fill ="#cdb4db" ,color = "white", linewidth = 0.2) +
labs(
title = "District Boundaries of Uganda",
caption = paste("Data Source: DuckDB | Plotted:", Sys.Date())
) +
ggthemes::theme_map(base_size = 12)
p <- ggplot(data = districts_sf) +
geom_sf(fill ="#cdb4db" ,color = "white", linewidth = 0.2) +
labs(
title = "District Boundaries of Uganda",
caption = paste("Data Source: DuckDB | Plotted:", Sys.Date())
) +
ggthemes::theme_map(base_size = 12) +
theme(
legend.position = "none",
plot.title = element_text(hjust = 0.5, face = "bold"),
plot.subtitle = element_text(hjust = 0.5)
)
ggsave(p,"map.png")
p
